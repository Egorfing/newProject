"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[767],{"./src/pages/ProfilePage/ui/ProfilePage.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Dark:function(){return Dark},Normal:function(){return Normal},__namedExportsOrder:function(){return __namedExportsOrder},default:function(){return ProfilePage_stories}});var Country=__webpack_require__("./src/entities/Country/index.ts"),Currency=__webpack_require__("./src/entities/Currency/index.ts"),StoreDecorator=__webpack_require__("./src/shared/config/storybook/StoreDecorator/StoreDecorator.tsx"),ThemeDecorator=__webpack_require__("./src/shared/config/storybook/ThemeDecorator/ThemeDecorator.tsx"),react=__webpack_require__("./node_modules/react/index.js"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),react_router=__webpack_require__("./node_modules/react-router/index.js"),EditableProfileCard=__webpack_require__("./src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx"),classNames=__webpack_require__("./src/shared/lib/classNames/classNames.ts"),Stack=__webpack_require__("./src/shared/ui/Stack/index.ts"),Text=__webpack_require__("./src/shared/ui/Text/Text.tsx"),Page=__webpack_require__("./src/widgets/Page/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");var ui_ProfilePage=(0,react.memo)((_ref=>{let{className:className}=_ref;const{id:id}=(0,react_router.W4)(),{t:t}=(0,useTranslation.G)("profile");return id?(0,jsx_runtime.jsx)(Page.K,{"data-testId":"ProfilePage",className:(0,classNames.g)("",{},[className]),children:(0,jsx_runtime.jsx)(Stack.y,{gap:"16",max:!0,children:(0,jsx_runtime.jsx)(EditableProfileCard.c,{id:id})})}):(0,jsx_runtime.jsx)(Text.a,{text:t("Профиль не найден")})})),theme=__webpack_require__("./src/shared/const/theme.ts"),ProfilePage_stories={title:"pages/ProfilePage",component:ui_ProfilePage,argTypes:{backgroundColor:{control:"color"}}};const Template=args=>(0,jsx_runtime.jsx)(ui_ProfilePage,{...args});Template.displayName="Template";const Normal=Template.bind({});Normal.args={},Normal.decorators=[(0,StoreDecorator.y)({profile:{form:{username:"admin",age:22,country:Country.y.Russia,lastname:"adminov",first:"ads",city:"SPB",currency:Currency._.RUB}}})];const Dark=Template.bind({});Dark.args={},Dark.decorators=[(0,ThemeDecorator.A)(theme.S.DARK),(0,StoreDecorator.y)({})],Normal.parameters={...Normal.parameters,docs:{...Normal.parameters?.docs,source:{originalSource:"args => <ProfilePage {...args} />",...Normal.parameters?.docs?.source}}},Dark.parameters={...Dark.parameters,docs:{...Dark.parameters?.docs,source:{originalSource:"args => <ProfilePage {...args} />",...Dark.parameters?.docs?.source}}};const __namedExportsOrder=["Normal","Dark"]},"./src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{c:function(){return EditableProfileCard}});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),classNames=__webpack_require__("./src/shared/lib/classNames/classNames.ts"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),ProfileCard=__webpack_require__("./src/entities/Profile/ui/ProfileCard/ProfileCard.tsx"),Text=__webpack_require__("./src/shared/ui/Text/Text.tsx"),useAppDispatch=__webpack_require__("./src/shared/lib/hooks/useAppDispatch/useAppDispatch.ts"),getProfileState=__webpack_require__("./src/features/editableProfileCard/model/selectors/getProfileState.ts"),useInitialEffect=__webpack_require__("./src/shared/lib/hooks/useInitialEffect/useInitialEffect.ts"),profileSlice=__webpack_require__("./src/features/editableProfileCard/model/slice/profileSlice.ts"),DynamicModuleLoader=__webpack_require__("./src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx"),fetchProfileData=__webpack_require__("./src/features/editableProfileCard/model/services/fetchProfileData/fetchProfileData.ts"),Stack=__webpack_require__("./src/shared/ui/Stack/index.ts"),User=__webpack_require__("./src/entities/User/index.ts"),Button=__webpack_require__("./src/shared/ui/Button/Button.tsx"),updateProfileData=__webpack_require__("./src/features/editableProfileCard/model/services/updateProfileData/updateProfileData.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const EditableProfileCardHeader=_ref=>{let{className:className}=_ref;const{t:t}=(0,useTranslation.G)(),dispatch=(0,useAppDispatch.A)(),readOnly=(0,es.w1)(getProfileState.Ir),authData=(0,es.w1)(User.Go),profileData=(0,es.w1)(getProfileState.c5),canEdit=authData?.id===profileData?.id,onEdit=(0,react.useCallback)((()=>{dispatch(profileSlice.gV.setReadOnly(!1))}),[dispatch]),onCancelEdit=(0,react.useCallback)((()=>{dispatch(profileSlice.gV.cancelEdit())}),[dispatch]),onSave=(0,react.useCallback)((()=>{dispatch((0,updateProfileData.U)())}),[]);return(0,jsx_runtime.jsxs)(Stack.k,{max:!0,justify:"between",className:(0,classNames.g)("",{},[className]),children:[(0,jsx_runtime.jsx)(Text.a,{title:t("Профиль")}),canEdit&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:readOnly?(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE,onClick:onEdit,"data-testid":"EditableProfileCardHeader.EditButton",children:t("Редактировать")}):(0,jsx_runtime.jsxs)(Stack.k,{gap:"8",children:[(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE_RED,onClick:onCancelEdit,"data-testid":"EditableProfileCardHeader.CancelButton",children:t("Отменить")}),(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE,onClick:onSave,"data-testid":"EditableProfileCardHeader.SaveButton",children:t("Сохранить")})]})})]})};EditableProfileCardHeader.displayName="EditableProfileCardHeader";try{EditableProfileCardHeader.displayName="EditableProfileCardHeader",EditableProfileCardHeader.__docgenInfo={description:"",displayName:"EditableProfileCardHeader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/features/editableProfileCard/ui/EditableProfileCardHeader/EditableProfileCardHeader.tsx#EditableProfileCardHeader"]={docgenInfo:EditableProfileCardHeader.__docgenInfo,name:"EditableProfileCardHeader",path:"src/features/editableProfileCard/ui/EditableProfileCardHeader/EditableProfileCardHeader.tsx#EditableProfileCardHeader"})}catch(__react_docgen_typescript_loader_error){}var profileConstants=__webpack_require__("./src/features/editableProfileCard/model/constants/profileConstants.ts");const reducers={profile:profileSlice.SW},EditableProfileCard=(0,react.memo)((props=>{const{className:className,id:id}=props,{t:t}=(0,useTranslation.G)("profile"),dispatch=(0,useAppDispatch.A)(),formData=(0,es.w1)(getProfileState.Ej),error=(0,es.w1)(getProfileState.ih),isLoading=(0,es.w1)(getProfileState.wn),readOnly=(0,es.w1)(getProfileState.Ir),validateErrors=(0,es.w1)(getProfileState.ek),validateErrorTranslates={[profileConstants.K.INCORRECT_USER_DATA]:t("Некорректные имя/фамилия"),[profileConstants.K.INCORRECT_AGE]:t("Некорректный возраст"),[profileConstants.K.INCORRECT_COUNTRY]:t("Некорректная страна"),[profileConstants.K.NO_DATA]:t("Отсутствуют данные"),[profileConstants.K.SERVER_ERROR]:t("Ошибка сервера")};(0,useInitialEffect.w)((()=>{id&&dispatch((0,fetchProfileData.D)(id))}));const onChangeFirstname=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({first:value||""}))}),[dispatch]),onChangeLastname=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({lastname:value||""}))}),[dispatch]),onChangeAge=(0,react.useCallback)((value=>{value&&/^[0-9]*$/.test(value)&&dispatch(profileSlice.gV.updateProfile({age:Number(value||0)}))}),[dispatch]),onChangeCity=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({city:value||""}))}),[dispatch]),onChangeUsername=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({username:value||""}))}),[dispatch]),onChangeAvatar=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({avatar:value||""}))}),[dispatch]),onChangeCurrency=(0,react.useCallback)((currency=>{dispatch(profileSlice.gV.updateProfile({currency:currency}))}),[dispatch]),onChangeCountry=(0,react.useCallback)((country=>{dispatch(profileSlice.gV.updateProfile({country:country}))}),[dispatch]);return(0,jsx_runtime.jsx)(DynamicModuleLoader.S,{reducers:reducers,children:(0,jsx_runtime.jsxs)(Stack.y,{gap:"8",max:!0,className:(0,classNames.g)("",{},[className]),children:[(0,jsx_runtime.jsx)(EditableProfileCardHeader,{}),validateErrors?.length&&validateErrors.map((err=>(0,jsx_runtime.jsx)(Text.a,{theme:Text.IN.ERROR,text:validateErrorTranslates[err],"data-testid":"EditableProfileCard.Error"},err))),(0,jsx_runtime.jsx)(ProfileCard.o,{data:formData,isLoading:isLoading,error:error,readOnly:readOnly,onChangeFirstname:onChangeFirstname,onChangeLastname:onChangeLastname,onChangeAge:onChangeAge,onChangeCity:onChangeCity,onChangeUsername:onChangeUsername,onChangeAvatar:onChangeAvatar,onChangeCurrency:onChangeCurrency,onChangeCountry:onChangeCountry})]})})}));try{EditableProfileCard.displayName="EditableProfileCard",EditableProfileCard.__docgenInfo={description:"",displayName:"EditableProfileCard",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx#EditableProfileCard"]={docgenInfo:EditableProfileCard.__docgenInfo,name:"EditableProfileCard",path:"src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx#EditableProfileCard"})}catch(__react_docgen_typescript_loader_error){}},"./src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{S:function(){return DynamicModuleLoader}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/es/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const DynamicModuleLoader=props=>{const{children:children,reducers:reducers,removeAfterUnmount:removeAfterUnmount=!0}=props,store=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.o3)(),dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.OY)();return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{const mountedReducers=store.reducerManager.getReducerMap();return Object.entries(reducers).forEach((_ref=>{let[name,reducer]=_ref;mountedReducers[name]||(store.reducerManager.add(name,reducer),dispatch({type:`@INIT ${name} reducer`}))})),()=>{removeAfterUnmount&&Object.entries(reducers).forEach((_ref2=>{let[name,reducer]=_ref2;store.reducerManager.remove(name),dispatch({type:`@DESTROY ${name} reducer`})}))}}),[]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:children})};try{DynamicModuleLoader.displayName="DynamicModuleLoader",DynamicModuleLoader.__docgenInfo={description:"",displayName:"DynamicModuleLoader",props:{reducers:{defaultValue:null,description:"",name:"reducers",required:!0,type:{name:"ReducersList"}},removeAfterUnmount:{defaultValue:null,description:"",name:"removeAfterUnmount",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx#DynamicModuleLoader"]={docgenInfo:DynamicModuleLoader.__docgenInfo,name:"DynamicModuleLoader",path:"src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx#DynamicModuleLoader"})}catch(__react_docgen_typescript_loader_error){}},"./src/shared/lib/hooks/useAppDispatch/useAppDispatch.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return useAppDispatch}});var react_redux__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react-redux/es/index.js");const useAppDispatch=()=>(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.OY)()},"./src/shared/lib/hooks/useInitialEffect/useInitialEffect.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{w:function(){return useInitialEffect}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function useInitialEffect(callback){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{0}),[])}},"./src/widgets/Page/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{K:function(){return Page}});var react=__webpack_require__("./node_modules/react/index.js"),react_router=__webpack_require__("./node_modules/react-router/index.js"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),Page_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[16].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/widgets/Page/Page.module.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(Page_module.c,options);var Page_Page_module=Page_module.c&&Page_module.c.locals?Page_module.c.locals:void 0,UI=__webpack_require__("./src/features/UI/index.ts"),classNames=__webpack_require__("./src/shared/lib/classNames/classNames.ts");var useAppDispatch=__webpack_require__("./src/shared/lib/hooks/useAppDispatch/useAppDispatch.ts"),useInitialEffect=__webpack_require__("./src/shared/lib/hooks/useInitialEffect/useInitialEffect.ts"),es=__webpack_require__("./node_modules/react-redux/es/index.js");var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Page=props=>{const{className:className,children:children,onScrollEnd:onScrollEnd}=props,wrapperRef=(0,react.useRef)(),triggerRef=(0,react.useRef)(),dispatch=(0,useAppDispatch.A)(),{pathname:pathname}=(0,react_router.IT)(),scrollPosition=(0,es.w1)((state=>(0,UI.ot)(state,pathname)));!function useInfiniteScroll(_ref){let{callback:callback,triggerRef:triggerRef,wrapperRef:wrapperRef}=_ref;(0,react.useEffect)((()=>{const wrapperElement=wrapperRef.current,triggerElement=triggerRef.current;let observer=null;return callback&&(observer=new IntersectionObserver((_ref2=>{let[entry]=_ref2;entry.isIntersecting&&callback()}),{root:wrapperElement,rootMargin:"0px",threshold:1}),observer.observe(triggerElement)),()=>{observer&&triggerElement&&observer.unobserve(triggerElement)}}),[triggerRef,wrapperRef])}({triggerRef:triggerRef,wrapperRef:wrapperRef,callback:onScrollEnd}),(0,useInitialEffect.w)((()=>{wrapperRef.current.scrollTop=scrollPosition}));const onScroll=function useThrottle(callback,delay){const throttleRef=(0,react.useRef)(!1);return(0,react.useCallback)((function(){throttleRef.current||(callback(...arguments),throttleRef.current=!0,setTimeout((()=>{throttleRef.current=!1}),delay))}),[callback,delay])}((e=>{dispatch(UI._i.setScrollPosition({position:e.currentTarget.scrollTop,path:pathname}))}),500);return(0,jsx_runtime.jsxs)("main",{ref:wrapperRef,className:(0,classNames.g)(Page_Page_module.Page,{},[className]),onScroll:onScroll,"data-testId":props["data-testId"]??"Page",children:[children,onScrollEnd?(0,jsx_runtime.jsx)("div",{className:Page_Page_module.trigger,ref:triggerRef}):null]})};Page.displayName="Page";try{Page.displayName="Page",Page.__docgenInfo={description:"",displayName:"Page",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onScrollEnd:{defaultValue:null,description:"",name:"onScrollEnd",required:!1,type:{name:"(() => void)"}},"data-testId":{defaultValue:null,description:"",name:"data-testId",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/widgets/Page/Page.tsx#Page"]={docgenInfo:Page.__docgenInfo,name:"Page",path:"src/widgets/Page/Page.tsx#Page"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[16].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/widgets/Page/Page.module.scss":function(module,__webpack_exports__,__webpack_require__){var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".src-widgets-Page-Page-module__Page--a83jD{flex-grow:1;padding:20px 20px 20px 45px;height:calc(100vh - var(--navbar-height));width:calc(100% - var(--sidebar-width));overflow-y:auto}.src-widgets-Page-Page-module__trigger--VaPQ_{height:20px;margin:10px}","",{version:3,sources:["webpack://./src/widgets/Page/Page.module.scss"],names:[],mappings:"AAAA,2CACI,WAAA,CACA,2BAAA,CACA,yCAAA,CACA,uCAAA,CACA,eAAA,CAGJ,8CACI,WAAA,CACA,WAAA",sourcesContent:[".Page {\n    flex-grow: 1;\n    padding: 20px 20px 20px 45px;\n    height: calc(100vh - var(--navbar-height));\n    width: calc(100% - var(--sidebar-width));\n    overflow-y: auto;\n}\n\n.trigger {\n    height: 20px;\n    margin: 10px;\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={Page:"src-widgets-Page-Page-module__Page--a83jD",trigger:"src-widgets-Page-Page-module__trigger--VaPQ_"},__webpack_exports__.c=___CSS_LOADER_EXPORT___}}]);