"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[228],{"./src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Normal:function(){return Normal},__namedExportsOrder:function(){return __namedExportsOrder}});__webpack_require__("./node_modules/react/index.js");var _EditableProfileCard__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");__webpack_exports__.default={title:"features/EditableProfileCard",component:_EditableProfileCard__WEBPACK_IMPORTED_MODULE_1__.c,argTypes:{backgroundColor:{control:"color"}}};const Template=args=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_EditableProfileCard__WEBPACK_IMPORTED_MODULE_1__.c,{...args});Template.displayName="Template";const Normal=Template.bind({});Normal.args={},Normal.parameters={...Normal.parameters,docs:{...Normal.parameters?.docs,source:{originalSource:"args => <EditableProfileCard {...args} />",...Normal.parameters?.docs?.source}}};const __namedExportsOrder=["Normal"]},"./src/entities/User/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Go:function(){return getUserAuthData},C6:function(){return isUserAdmin},_5:function(){return isUserManager},By:function(){return userActions},If:function(){return userReducer}});var redux_toolkit_esm=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js"),localstorage=__webpack_require__("./src/shared/const/localstorage.ts");const userSlice=(0,redux_toolkit_esm.is)({name:"user",initialState:{_inited:!1},reducers:{setAuthData:(state,action)=>{state.authData=action.payload},initAuthData:state=>{const user=localStorage.getItem(localstorage.a2);user&&(state.authData=JSON.parse(user)),state._inited=!0},logout:state=>{state.authData=void 0,localStorage.removeItem(localstorage.a2)}}}),{actions:userActions}=userSlice,{reducer:userReducer}=userSlice;let UserRole=function(UserRole){return UserRole.ADMIN="ADMIN",UserRole.USER="USER",UserRole.MANAGER="MANAGER",UserRole}({});const getUserAuthData=state=>state.user.authData;var es=__webpack_require__("./node_modules/reselect/es/index.js");const getUserRoles=state=>state.user.authData?.roles,isUserAdmin=(0,es.M3)(getUserRoles,(roles=>Boolean(roles?.includes(UserRole.ADMIN)))),isUserManager=(0,es.M3)(getUserRoles,(roles=>Boolean(roles?.includes(UserRole.MANAGER))));try{getUserRoles.displayName="getUserRoles",getUserRoles.__docgenInfo={description:"",displayName:"getUserRoles",props:{counter:{defaultValue:null,description:"",name:"counter",required:!0,type:{name:"CounterSchema"}},user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"UserSchema"}},ui:{defaultValue:null,description:"",name:"ui",required:!0,type:{name:"UISchema"}},loginForm:{defaultValue:null,description:"",name:"loginForm",required:!1,type:{name:"LoginSchema"}},profile:{defaultValue:null,description:"",name:"profile",required:!1,type:{name:"ProfileSchema"}},articleDetails:{defaultValue:null,description:"",name:"articleDetails",required:!1,type:{name:"ArticleDetailsSchema"}},addCommentForm:{defaultValue:null,description:"",name:"addCommentForm",required:!1,type:{name:"AddCommentFormSchema"}},articlesPage:{defaultValue:null,description:"",name:"articlesPage",required:!1,type:{name:"ArticlePageSchema"}},articlesDetailsPage:{defaultValue:null,description:"",name:"articlesDetailsPage",required:!1,type:{name:"ArticleDetailsPageSchema"}},api:{defaultValue:null,description:"",name:"api",required:!0,type:{name:'CombinedState<{}, never, "api">'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/User/model/selectors/roleSelectors.tsx#getUserRoles"]={docgenInfo:getUserRoles.__docgenInfo,name:"getUserRoles",path:"src/entities/User/model/selectors/roleSelectors.tsx#getUserRoles"})}catch(__react_docgen_typescript_loader_error){}},"./src/features/editableProfileCard/model/constants/profileConstants.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{K:function(){return ValidateProfileError}});let ValidateProfileError=function(ValidateProfileError){return ValidateProfileError.INCORRECT_USER_DATA="INCORRECT_USER_DATA",ValidateProfileError.INCORRECT_AGE="INCORRECT_AGE",ValidateProfileError.INCORRECT_COUNTRY="INCORRECT_COUNTRY",ValidateProfileError.NO_DATA="NO_DATA",ValidateProfileError.SERVER_ERROR="SERVER_ERROR",ValidateProfileError}({})},"./src/features/editableProfileCard/model/selectors/getProfileState.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Ej:function(){return getProfileForm},Ir:function(){return getProfileReadOnly},c5:function(){return getProfileData},ek:function(){return getProfileValidateErrors},ih:function(){return getProfileError},wn:function(){return getProfileIsLoading}});const getProfileData=state=>state?.profile?.data,getProfileForm=state=>state?.profile?.form,getProfileError=state=>state?.profile?.error,getProfileIsLoading=state=>state?.profile?.isLoading,getProfileReadOnly=state=>state?.profile?.readonly,getProfileValidateErrors=state=>state?.profile?.validateErrors},"./src/features/editableProfileCard/model/services/fetchProfileData/fetchProfileData.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{D:function(){return fetchProfileData}});const fetchProfileData=(0,__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js").aw)("profile/fetchProfileData",(async(profileId,_ref)=>{let{rejectWithValue:rejectWithValue,extra:extra}=_ref;try{const response=await extra.api.get(`/profile/${profileId}`);if(!response.data)throw new Error;return response.data}catch(error){return console.log(error),rejectWithValue("error")}}))},"./src/features/editableProfileCard/model/services/updateProfileData/updateProfileData.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{U:function(){return updateProfileData}});var redux_toolkit_esm=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js"),profileConstants=__webpack_require__("./src/features/editableProfileCard/model/constants/profileConstants.ts");var getProfileState=__webpack_require__("./src/features/editableProfileCard/model/selectors/getProfileState.ts");const updateProfileData=(0,redux_toolkit_esm.aw)("profile/updateProfileData",(async(_,_ref)=>{let{rejectWithValue:rejectWithValue,extra:extra,getState:getState}=_ref;const formData=(0,getProfileState.Ej)(getState()),errors=(profile=>{if(!profile)return[profileConstants.K.NO_DATA];const{first:first,lastname:lastname,age:age,country:country}=profile,errors=[];return first&&lastname||errors.push(profileConstants.K.INCORRECT_USER_DATA),age&&Number.isInteger(age)||errors.push(profileConstants.K.INCORRECT_AGE),country||errors.push(profileConstants.K.INCORRECT_COUNTRY),errors})(formData);if(errors.length)return rejectWithValue(errors);try{const response=await extra.api.put(`/profile/${formData?.id}`,formData);if(!response.data)throw new Error;return response.data}catch(error){return console.log(error),rejectWithValue([profileConstants.K.SERVER_ERROR])}}))},"./src/features/editableProfileCard/model/slice/profileSlice.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{SW:function(){return profileReducer},gV:function(){return profileActions}});var _reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js"),_features_editableProfileCard_model_services_fetchProfileData_fetchProfileData__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/features/editableProfileCard/model/services/fetchProfileData/fetchProfileData.ts"),_features_editableProfileCard_model_services_updateProfileData_updateProfileData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/features/editableProfileCard/model/services/updateProfileData/updateProfileData.ts");const initialState={readonly:!0,isLoading:!1,error:void 0,data:void 0},profileSlice=(0,_reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_2__.is)({name:"profile",initialState:initialState,reducers:{setReadOnly:(state,action)=>{state.readonly=action.payload},updateProfile:(state,action)=>{state.form={...state.form,...action.payload}},cancelEdit:state=>{state.readonly=!0,state.validateErrors=void 0,state.form=state.data}},extraReducers:builder=>{builder.addCase(_features_editableProfileCard_model_services_fetchProfileData_fetchProfileData__WEBPACK_IMPORTED_MODULE_0__.D.pending,(state=>{state.error=void 0,state.isLoading=!0})).addCase(_features_editableProfileCard_model_services_fetchProfileData_fetchProfileData__WEBPACK_IMPORTED_MODULE_0__.D.fulfilled,((state,action)=>{state.isLoading=!1,state.data=action.payload,state.form=action.payload})).addCase(_features_editableProfileCard_model_services_fetchProfileData_fetchProfileData__WEBPACK_IMPORTED_MODULE_0__.D.rejected,((state,action)=>{state.isLoading=!1,state.error=action.payload})).addCase(_features_editableProfileCard_model_services_updateProfileData_updateProfileData__WEBPACK_IMPORTED_MODULE_1__.U.pending,(state=>{state.validateErrors=void 0,state.isLoading=!0})).addCase(_features_editableProfileCard_model_services_updateProfileData_updateProfileData__WEBPACK_IMPORTED_MODULE_1__.U.fulfilled,((state,action)=>{state.isLoading=!1,state.data=action.payload,state.form=action.payload,state.readonly=!0,state.validateErrors=void 0})).addCase(_features_editableProfileCard_model_services_updateProfileData_updateProfileData__WEBPACK_IMPORTED_MODULE_1__.U.rejected,((state,action)=>{state.isLoading=!1,state.validateErrors=action.payload}))}}),{actions:profileActions}=profileSlice,{reducer:profileReducer}=profileSlice},"./src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{c:function(){return EditableProfileCard}});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),classNames=__webpack_require__("./src/shared/lib/classNames/classNames.ts"),useTranslation=__webpack_require__("./node_modules/react-i18next/dist/es/useTranslation.js"),ProfileCard=__webpack_require__("./src/entities/Profile/ui/ProfileCard/ProfileCard.tsx"),Text=__webpack_require__("./src/shared/ui/Text/Text.tsx"),useAppDispatch=__webpack_require__("./src/shared/lib/hooks/useAppDispatch/useAppDispatch.ts"),getProfileState=__webpack_require__("./src/features/editableProfileCard/model/selectors/getProfileState.ts"),useInitialEffect=__webpack_require__("./src/shared/lib/hooks/useInitialEffect/useInitialEffect.ts"),profileSlice=__webpack_require__("./src/features/editableProfileCard/model/slice/profileSlice.ts"),DynamicModuleLoader=__webpack_require__("./src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx"),fetchProfileData=__webpack_require__("./src/features/editableProfileCard/model/services/fetchProfileData/fetchProfileData.ts"),Stack=__webpack_require__("./src/shared/ui/Stack/index.ts"),User=__webpack_require__("./src/entities/User/index.ts"),Button=__webpack_require__("./src/shared/ui/Button/Button.tsx"),updateProfileData=__webpack_require__("./src/features/editableProfileCard/model/services/updateProfileData/updateProfileData.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const EditableProfileCardHeader=_ref=>{let{className:className}=_ref;const{t:t}=(0,useTranslation.G)(),dispatch=(0,useAppDispatch.A)(),readOnly=(0,es.w1)(getProfileState.Ir),authData=(0,es.w1)(User.Go),profileData=(0,es.w1)(getProfileState.c5),canEdit=authData?.id===profileData?.id,onEdit=(0,react.useCallback)((()=>{dispatch(profileSlice.gV.setReadOnly(!1))}),[dispatch]),onCancelEdit=(0,react.useCallback)((()=>{dispatch(profileSlice.gV.cancelEdit())}),[dispatch]),onSave=(0,react.useCallback)((()=>{dispatch((0,updateProfileData.U)())}),[]);return(0,jsx_runtime.jsxs)(Stack.k,{max:!0,justify:"between",className:(0,classNames.g)("",{},[className]),children:[(0,jsx_runtime.jsx)(Text.a,{title:t("Профиль")}),canEdit&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:readOnly?(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE,onClick:onEdit,"data-testid":"EditableProfileCardHeader.EditButton",children:t("Редактировать")}):(0,jsx_runtime.jsxs)(Stack.k,{gap:"8",children:[(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE_RED,onClick:onCancelEdit,"data-testid":"EditableProfileCardHeader.CancelButton",children:t("Отменить")}),(0,jsx_runtime.jsx)(Button.q,{theme:Button.iS.OUTLINE,onClick:onSave,"data-testid":"EditableProfileCardHeader.SaveButton",children:t("Сохранить")})]})})]})};EditableProfileCardHeader.displayName="EditableProfileCardHeader";try{EditableProfileCardHeader.displayName="EditableProfileCardHeader",EditableProfileCardHeader.__docgenInfo={description:"",displayName:"EditableProfileCardHeader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/features/editableProfileCard/ui/EditableProfileCardHeader/EditableProfileCardHeader.tsx#EditableProfileCardHeader"]={docgenInfo:EditableProfileCardHeader.__docgenInfo,name:"EditableProfileCardHeader",path:"src/features/editableProfileCard/ui/EditableProfileCardHeader/EditableProfileCardHeader.tsx#EditableProfileCardHeader"})}catch(__react_docgen_typescript_loader_error){}var profileConstants=__webpack_require__("./src/features/editableProfileCard/model/constants/profileConstants.ts");const reducers={profile:profileSlice.SW},EditableProfileCard=(0,react.memo)((props=>{const{className:className,id:id}=props,{t:t}=(0,useTranslation.G)("profile"),dispatch=(0,useAppDispatch.A)(),formData=(0,es.w1)(getProfileState.Ej),error=(0,es.w1)(getProfileState.ih),isLoading=(0,es.w1)(getProfileState.wn),readOnly=(0,es.w1)(getProfileState.Ir),validateErrors=(0,es.w1)(getProfileState.ek),validateErrorTranslates={[profileConstants.K.INCORRECT_USER_DATA]:t("Некорректные имя/фамилия"),[profileConstants.K.INCORRECT_AGE]:t("Некорректный возраст"),[profileConstants.K.INCORRECT_COUNTRY]:t("Некорректная страна"),[profileConstants.K.NO_DATA]:t("Отсутствуют данные"),[profileConstants.K.SERVER_ERROR]:t("Ошибка сервера")};(0,useInitialEffect.w)((()=>{id&&dispatch((0,fetchProfileData.D)(id))}));const onChangeFirstname=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({first:value||""}))}),[dispatch]),onChangeLastname=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({lastname:value||""}))}),[dispatch]),onChangeAge=(0,react.useCallback)((value=>{value&&/^[0-9]*$/.test(value)&&dispatch(profileSlice.gV.updateProfile({age:Number(value||0)}))}),[dispatch]),onChangeCity=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({city:value||""}))}),[dispatch]),onChangeUsername=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({username:value||""}))}),[dispatch]),onChangeAvatar=(0,react.useCallback)((value=>{dispatch(profileSlice.gV.updateProfile({avatar:value||""}))}),[dispatch]),onChangeCurrency=(0,react.useCallback)((currency=>{dispatch(profileSlice.gV.updateProfile({currency:currency}))}),[dispatch]),onChangeCountry=(0,react.useCallback)((country=>{dispatch(profileSlice.gV.updateProfile({country:country}))}),[dispatch]);return(0,jsx_runtime.jsx)(DynamicModuleLoader.S,{reducers:reducers,children:(0,jsx_runtime.jsxs)(Stack.y,{gap:"8",max:!0,className:(0,classNames.g)("",{},[className]),children:[(0,jsx_runtime.jsx)(EditableProfileCardHeader,{}),validateErrors?.length&&validateErrors.map((err=>(0,jsx_runtime.jsx)(Text.a,{theme:Text.IN.ERROR,text:validateErrorTranslates[err],"data-testid":"EditableProfileCard.Error"},err))),(0,jsx_runtime.jsx)(ProfileCard.o,{data:formData,isLoading:isLoading,error:error,readOnly:readOnly,onChangeFirstname:onChangeFirstname,onChangeLastname:onChangeLastname,onChangeAge:onChangeAge,onChangeCity:onChangeCity,onChangeUsername:onChangeUsername,onChangeAvatar:onChangeAvatar,onChangeCurrency:onChangeCurrency,onChangeCountry:onChangeCountry})]})})}));try{EditableProfileCard.displayName="EditableProfileCard",EditableProfileCard.__docgenInfo={description:"",displayName:"EditableProfileCard",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx#EditableProfileCard"]={docgenInfo:EditableProfileCard.__docgenInfo,name:"EditableProfileCard",path:"src/features/editableProfileCard/ui/EditableProfileCard/EditableProfileCard.tsx#EditableProfileCard"})}catch(__react_docgen_typescript_loader_error){}},"./src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{S:function(){return DynamicModuleLoader}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/es/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const DynamicModuleLoader=props=>{const{children:children,reducers:reducers,removeAfterUnmount:removeAfterUnmount=!0}=props,store=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.o3)(),dispatch=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.OY)();return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{const mountedReducers=store.reducerManager.getReducerMap();return Object.entries(reducers).forEach((_ref=>{let[name,reducer]=_ref;mountedReducers[name]||(store.reducerManager.add(name,reducer),dispatch({type:`@INIT ${name} reducer`}))})),()=>{removeAfterUnmount&&Object.entries(reducers).forEach((_ref2=>{let[name,reducer]=_ref2;store.reducerManager.remove(name),dispatch({type:`@DESTROY ${name} reducer`})}))}}),[]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:children})};try{DynamicModuleLoader.displayName="DynamicModuleLoader",DynamicModuleLoader.__docgenInfo={description:"",displayName:"DynamicModuleLoader",props:{reducers:{defaultValue:null,description:"",name:"reducers",required:!0,type:{name:"ReducersList"}},removeAfterUnmount:{defaultValue:null,description:"",name:"removeAfterUnmount",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx#DynamicModuleLoader"]={docgenInfo:DynamicModuleLoader.__docgenInfo,name:"DynamicModuleLoader",path:"src/shared/lib/components/DynamicModuleLoader/DynamicModuleLoader.tsx#DynamicModuleLoader"})}catch(__react_docgen_typescript_loader_error){}},"./src/shared/lib/hooks/useAppDispatch/useAppDispatch.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return useAppDispatch}});var react_redux__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react-redux/es/index.js");const useAppDispatch=()=>(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.OY)()},"./src/shared/lib/hooks/useInitialEffect/useInitialEffect.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{w:function(){return useInitialEffect}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function useInitialEffect(callback){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{0}),[])}}}]);